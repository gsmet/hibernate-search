sudo: required
dist: trusty
language: java
addons:
  # for now, let's test only with H2
  #postgresql: '9.4'
  #mariadb: '10.0'
  apt:
    packages:
      - oracle-java8-installer
# might be useful to push reports to an S3 bucket
#  artifacts:
#    paths:
#      - $(find $HOME -name surefire-reports | tr "\n" ":")
#      - $(find $HOME -name failsafe-reports | tr "\n" ":")
#  s3_region: 'us-west-2'
cache:
  directories:
    - $HOME/.m2
env:
  - DB=h2
  # for now, let's test only with H2
  #- DB=pgsql
  #- DB=mariadb
install:
  # The Maven install provided by Travis is outdated, use Maven wrapper to get the latest version
  - mvn -N io.takari:maven:wrapper
  - ./mvnw -v
  # We declare explicitly Maven Central as the JBoss repository takes precedences over it
  - sed -i settings-example.xml -e "s@<repositories>@<repositories><repository><id>central</id><name>Central</name><url>http://repo1.maven.org/maven2/</url></repository>@"
  - sed -i settings-example.xml -e "s@<pluginRepositories>@<pluginRepositories><pluginRepository><id>central</id><name>Central</name><url>http://repo1.maven.org/maven2/</url></pluginRepository>@"
  # first run to download all the Maven dependencies without logging
  - travis_wait ./mvnw -s settings-example.xml -B -q clean install -DskipTests=true -Dmaven.javadoc.skip=true
  # we run checkstyle first to fail fast if there is a styling error
  - ./mvnw -s settings-example.xml checkstyle:check
before_script: 
  - if [[ "$DB" == "pgsql" ]]; then psql -U postgres -f 'travis/pgsql.sql';fi 
  - if [[ "$DB" == "mariadb" ]]; then mysql -u root < 'travis/mariadb.sql'; fi
script:
  - if [[ "$DB" == "h2" ]]; then ./mvnw -s settings-example.xml -Pdocs,docbook,dist clean install;fi 
  - if [[ "$DB" == "pgsql" ]]; then ./mvnw -s settings-example.xml -Pci-postgresql,docs,docbook,dist clean install;fi 
  - if [[ "$DB" == "mariadb" ]]; then ./mvnw -s settings-example.xml -Pci-mariadb,docs,docbook,dist clean install; fi
